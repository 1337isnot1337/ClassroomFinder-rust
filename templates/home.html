<!DOCTYPE html>
<html>
  <head>
    <div class="warning_box">
      <div class="warning">
        <p style="padding: 10px;">Warning, this website is only supported on mobile.</p>
      </div>
    </div>
    <title>IMSA Classroom Finder</title>
    <link rel="stylesheet" href="/home.css" >
    <meta name= "viewport" content="width=device-width, initial-scale=1, user-scalable=no"/>
  </head>
  <body>
    <div class="map">
      <img class="hallway" src="/image" >
      <canvas width="1029" height="1182"> </canvas>
      
    </div>
    <div class="filler_box"></div>
    <div class="input_response">
      <div class="input_response_contents">
        <input id="start" type="text" placeholder="Enter Starting location" >
        <input id="end" type="text" placeholder="Enter Destination" >
        <button class="path_button" onclick="find_directions()">
          Find Shortest Path
        </button>
        <div class="message_box">
          <p id="message">this is a test.</p>
        </div>
        
      </div>
      
    </div>
    
    <script>
      document.body.addEventListener("mousedown", (current_click) =>{
        document.getElementsByClassName("warning_box")[0].style.display="none";
      })
      let canvas = document.getElementsByTagName("canvas")[0];
      let context = canvas.getContext("2d");
      const find_directions = () => {
        const starting_location = document.getElementById("start").value;
        const destination = document.getElementById("end").value;
        fetch("/get_directions", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify({
            "start-room": starting_location,
            destination: destination,
          }),
        })
          .then((data) => {
            return data.json();
          })
          .then((json) => {
            console.log(json);
            if (json.status == 1) {
              document.getElementById("message").style.color = "red";
              document.getElementById("message").innerHTML =
                "Error. Path could not be found.";
              return;
            }
            document.getElementById("message").style.color = "green";
            document.getElementById("message").innerHTML = "Path found!";
            context.clearRect(0, 0, canvas.width, canvas.height);
            context.beginPath();
            for (let i = 1; i < json.length; i++) {
              context.moveTo(json[i - 1]["x"], json[i - 1]["y"]);
              context.lineTo(json[i]["x"], json[i]["y"]);
              context.strokeStyle = "green";
              context.lineWidth = 5;
              context.stroke();
            }
          })
          .catch((err) => {
            console.log(err);
          });
      };
    </script>
  </body>
</html>
